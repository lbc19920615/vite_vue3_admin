var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,i=(e,i)=>{for(var l in i||(i={}))a.call(i,l)&&n(e,l,i[l]);if(t)for(var l of t(i))o.call(i,l)&&n(e,l,i[l]);return e};import{v as l,w as s,a4 as r,j as p,P as d,n as u,o as c,p as m,k as f,a5 as g}from"./index.872417fc.js";import{d as y,h as b,e as v,i as w,j as h}from"./ext.943b90d0.js";import{f as C}from"./nodes.a56b7126.js";import{a as _,r as x,e as E,f as S,F as L,g as k,w as j,C as D,k as P,A as M,d as T,h as N}from"./vendor.70e2a6e0.js";import"http://192.168.1.67:7002/public/expose/main.js";import"http://192.168.1.67:7002/public/expose/ext.js";import"./CommonRender.d6009dc7.js";import"./form.e330999e.js";async function O(e="",t=(()=>{})){let a=await ZY_EXT.store.getItem(e);Array.isArray(a)||(a=[]),a=await t(a),await ZY_EXT.store.setItem(e,a)}const V={name:"CusRoutesEditor",components:{ZEasyModal:y,EwXmlShower:b,ZLayoutEditor:v},mixins:[l],setup(e,t){var a,o;let n;console.log("props",e.form_slot_content),e.defs;let l=ZY.JSON5,p=ZY.rid(6);!async function(){await O("routes-store-prefix",(e=>(e.forEach((e=>{w(e)})),[])))}();let{data:d,methods:u,listeners:c,init:m}=s(e,t,{handleValueInit:(e,t)=>(e||(e="{data: {links: [], deps: []}, posMap: {}}"),e&&(n=l.parse(e)),t===r.init&&setTimeout((()=>{console.log("openDialog"),g()}),600),e)}),f=d({dialogVisible:!1,previewVisible:!1});async function g(){f.dialogVisible=!0,await O("routes-store-prefix",(e=>e.concat([p])))}m(e);let y=null;let b=null;async function v(){let e=b.getToolsData();await b.saveCache2Storage(e);let t=l.stringify(e);u.on_change(t)}function x(e){return h.js(getApp().buildDeepTree(e))}_((()=>{b&&(console.log("clearLayoutStorage"),b.clearLayoutStorage())}));let E=C({properties:{tagName:{type:"string",ui:{label:"标签名"}},page:{type:"string",ui:{label:"页"}},storeName:{type:"string",ui:{label:"缓存prefix"}},attro:{type:"object",properties:{path:{type:"string",ui:{label:"路径"}},hidden:{type:"boolean",ui:{label:"隐藏",widget:"CusSwitch",widgetConfig:{}},rules:{type:"any"}}}},metas:{type:"array",ui:{label:"META"},items:{type:"object",properties:{name:{type:"string",ui:{widget:"CusSuggest",widgetConfig:{placement:"top"}}},value:{type:"string",ui:{}}}}}},computed:{computedEditText:"MODEL('editText', '')"}},{form2:{storeName:"sdsdsds",attro:{}}});return{state:f,getXML:function(){b.getXML()},openDialog:g,onPlumbInited:async function({context:e}){await e.importToolsData(n),await ZY.sleep(300),await e.saveCache2Storage(n)},onEleDragChange:function(){},onClosed:async function(){await v()},onSaveLayout:function(e){console.log("onSaveLayout",e)},storePrefix:p,save:v,setLayoutRef:function(e,t){b=e},onDisplayOpened:function(){setTimeout((()=>{y.setModel(x(f.value))}),150)},setEditorRef:function(e,t){y=e},editorContent:E,toggleVisible:function(){f.previewVisible?f.previewVisible=!1:(f.previewVisible=!0,setTimeout((()=>{y.setModel(x(f.value))}),150))},onPlumbUpdate:function(e){let t=b.getToolsData(),a=l.stringify(t);f.value=a},getXMLDisplay:x,handleList1:function(){return[{name:"name",label:"节点",data:{tagName:"name",attro:{}}}].map((e=>({name:e.name,label:e.label,value:"",id:ZY.rid(),data:i({},e.data),items:e.items,lib:"control"})))},widgetConfig:null!=(o=null==(a=null==e?void 0:e.ui)?void 0:a.widgetConfig)?o:{},methods:u,listeners:c}}},I={class:"g-pointer-events-none-modal cus-routes-editor"},Z=["mode"],R=M("保存");V.render=function(e,t,a,o,n,i){const l=x("el-row"),s=x("el-button"),r=x("EwXmlShower"),p=x("slot-com"),d=x("ZLayoutEditor");return E(),S("div",I,[e.inited?(E(),S(L,{key:0},[k(l,{type:"flex",align:"top"}),o.state.dialogVisible?(E(),S("div",{key:0,mode:o.widgetConfig.mode},[k(l,{class:"a-space-mb-10"},{default:j((()=>[k(s,{type:"primary",onClick:o.save},{default:j((()=>[R])),_:1},8,["onClick"])])),_:1}),D("div",null,[k(r,{value:o.getXMLDisplay(o.state.value)},null,8,["value"])]),k(d,{ref:o.setLayoutRef,controls:!1,onEleDragChange:o.onEleDragChange,"store-prefix":o.storePrefix,"auto-load":!1,onPlumbInited:o.onPlumbInited,"onMode:update:all":o.onPlumbUpdate,onSaveLayout:o.onSaveLayout,"drawer-width":"750px","editor-content":o.editorContent,handleList1:o.handleList1,debug:!1,"open-panel":!1},{"plumb-layout-item-action-beforeend":j((t=>[k(p,{defs:e.form_slot_content,attrs:{},binds:{item:t.item,dep:t.dep},name:"route-link-custom"},null,8,["defs","binds"])])),_:1},8,["onEleDragChange","store-prefix","onPlumbInited","onMode:update:all","onSaveLayout","editor-content","handleList1"])],8,Z)):P("",!0)],64)):P("",!0)])},CustomVueComponent.register(V);const X=T({components:{HttpComponent:p},mixins:[d],data:()=>({}),setup(){const e=g;let t=null;let a,o=u({properties:{textarea_step:{type:String}},computed:{}},{onInited:function({storeControl:a}){o.commonLoadStep(f((()=>import("./EventEditorConfig.551e6b53.js")),[]),"textarea_step",{async onMounted(a){let n=await o.dispatchRoot("GetStoreEvents",{storeName:e});o.setPartModel(a.name,"form2",null!=n?n:{}),t=function(e){o.setPartModel(a.name,"form2",null!=e?e:{})}}})},extendContext:{},servicePrefix:"PageHomeIndexService"});return o=c(o),o=m(o),o.setEventHandler({"model:update:all"(e){let{model:t,key:n,newVal:i,config:l}=e;l.process===o.store.model.textarea_step&&(a=t)},"call:save:file"(e){a&&ZY_EXT.saveDesignFile({fileName:a.name,data:a,prefix:"app_"})}}),{store:o.store,getHref:function(e){var t,a,o,n,i;let l=null!=(a=null==(t=e.dep)?void 0:t.data)?a:{},s=new URLSearchParams;return s.append("page",null!=(o=l.tagName)?o:""),s.append("storeName",null!=(n=l.storeName)?n:""),s.append("path",null!=(i=l.attro.path)?i:""),"/about?"+s.toString()},page:o,importFile:async function(){let a=await ZY_EXT.fileOpenJSON5();if(a.data){let n=a.data;console.log(n),console.log(t),await o.dispatchRoot("SetStoreLocal",{storeName:e,data:n}),location.reload()}},allDef:o.defMap,save:async function(){await o.dispatchRoot("SetStoreLocal",{storeName:e,data:a})}}}}),Y={key:0,class:"page-home"},A=M("保存文件"),H=M("保存"),F=M("导入"),U=M("编辑");X.render=function(e,t,a,o,n,i){const l=x("el-button"),s=x("el-row"),r=x("el-link"),p=x("HttpComponent");return e.page.inited?(E(),S("div",Y,[k(s,{class:"a-space-mb-20"},{default:j((()=>[k(l,{type:"primary",onClick:t[0]||(t[0]=t=>e.page.callEvent("call:save:file"))},{default:j((()=>[A])),_:1}),k(l,{type:"primary",onClick:e.save},{default:j((()=>[H])),_:1},8,["onClick"]),k(l,{type:"primary",onClick:e.importFile},{default:j((()=>[F])),_:1},8,["onClick"])])),_:1}),e.store.model.textarea_step?(E(),N(p,{key:0,defs:e.allDef,is:e.store.model.textarea_step,debug:!1},{"route-link-custom":j((t=>[k(l,null,{default:j((()=>[k(r,{type:"primary",target:"_blank",href:e.getHref(t)},{default:j((()=>[U])),_:2},1032,["href"])])),_:2},1024)])),_:1},8,["defs","is"])):P("",!0)])):P("",!0)};export{X as default};
